#!/usr/bin/env bash

fd='/tmp/rund'

status() {
  local line 

  echo 'status' >"$fd"

  while read -r line; do
    echo "inside loop"
    echo "$line"
  done <"$fd"
}

run() {
  echo "$(pwd)/$1"
  echo 'run' >"$fd"
  sleep 0
  echo -n "$(pwd)/$1" >"$fd"
  sleep 0
}

exit_fn() {
  echo 'exit' >"$fd"
}

main(){
	case "$1" in
	'')
	  echo 'Please specify a command'
	  exit 1
	  ;;
	'exit')
	  exit_fn
	  ;;
	'status')
	  status
	  ;;
	'run')
	  run "$2"
	  ;;
	*)
	  echo 'Invalid Command!'
	  exit 1
	  ;;
	esac
}

main "$@"
